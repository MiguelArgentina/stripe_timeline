<!DOCTYPE html>
<html data-bs-theme="light">
<head>
  <title><%= content_for(:title) || "Stripe Timeline" %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="icon" href="/icon.png" type="image/png">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icon.png">

  <!-- Bootstrap CSS (load first) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  >

  <!-- Your overrides (loaded after Bootstrap so they win) -->
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body class="bg-body-tertiary">
<nav class="navbar navbar-expand bg-body border-bottom sticky-top shadow-sm" style="backdrop-filter:saturate(180%) blur(8px);">
  <div class="container-xxl">
    <%= link_to "Stripe Timeline", root_path, class: "navbar-brand fw-semibold" %>

    <div class="ms-auto d-flex align-items-center gap-2">
      <%= yield :navbar_right %>
      <span class="badge text-bg-secondary">
        Tenant: <%= Current.tenant&.name %> (#<%= Current.tenant&.id %>)
      </span>
      <!-- Optional: dark / light toggle (persists in localStorage) -->
      <button type="button" class="btn btn-sm btn-outline-secondary"
              id="themeToggle" aria-label="Toggle theme">Dark</button>
    </div>
  </div>
</nav>

<main class="container-xxl my-4">
  <%= yield %>
</main>
<%= render "transactions/event_modal" %>
<!-- Bootstrap JS bundle (Popper included) -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"
  defer
></script>
<!-- Tiny theme toggle (no framework deps). Safe to remove if you don't want it. -->
<script defer>
    (function() {
        const key = "pref-theme";
        const root = document.documentElement;
        const btn  = document.getElementById("themeToggle");

        // on load, apply saved theme
        const saved = localStorage.getItem(key);
        if (saved) {
            root.setAttribute("data-bs-theme", saved);
            if (btn) btn.textContent = saved === "dark" ? "Light" : "Dark";
        }

        // toggle + persist
        btn?.addEventListener("click", () => {
            const next = root.getAttribute("data-bs-theme") === "dark" ? "light" : "dark";
            root.setAttribute("data-bs-theme", next);
            localStorage.setItem(key, next);
            btn.textContent = next === "dark" ? "Light" : "Dark";
        });
    })();
</script>
<script>
    addEventListener("click", async (e) => {
        const btn = e.target.closest("[data-copy]");
        if (!btn) return;
        try {
            await navigator.clipboard.writeText(btn.getAttribute("data-copy"));
            const old = btn.textContent;
            btn.textContent = "copied";
            setTimeout(() => btn.textContent = old, 1200);
        } catch (_) {
            // fallback: select + prompt
            const t = btn.getAttribute("data-copy");
            window.prompt("Copy to clipboard:", t);
        }
    });
</script>
</body>
</html>
