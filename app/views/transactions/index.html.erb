<!-- app/views/transactions/index.html.erb -->
<h1>Recent Transactions</h1>

<%= turbo_stream_from "tx:index:#{Current.tenant.id}" %>

<form method="get" style="display:flex; gap:.5rem; align-items:center; margin:.5rem 0;">
  <select name="status">
    <option value="">All</option>
    <% %w[succeeded refunded disputed requires_payment_method].each do |st| %>
      <option value="<%= st %>" <%= "selected" if params[:status]==st %>><%= st %></option>
    <% end %>
  </select>
  <input type="date" name="from" value="<%= params[:from] %>">
  <input type="date" name="to"   value="<%= params[:to] %>">
  <button type="submit">Filter</button>

  <%# Export keeps current filters by passing the same query params %>
  <%= link_to "Export visible (CSV)",
              export_transactions_path(request.query_parameters),
              data: { turbo: false }, class: "btn" %>
</form>

<%= turbo_frame_tag "details" do %>
  <em>Select a transaction to view its timelineâ€¦</em>
<% end %>

<div class="summary-bar">
  <span class="<%= chip_class_for(:gross) %>">Gross <strong><%= format_cents(@stats[:gross], @stats[:currency]) %></strong></span>
  <span class="<%= chip_class_for(:refunds) %>">Refunds <strong><%= format_cents(@stats[:refunds], @stats[:currency]) %></strong></span>
  <span class="<%= chip_class_for(:disputed) %>">Disputed <strong><%= format_cents(@stats[:disputed], @stats[:currency]) %></strong></span>
  <span class="<%= chip_class_for(:net) %>">Net <strong><%= format_cents(@stats[:net], @stats[:currency]) %></strong></span>
  <span class="muted">(<%= @stats[:count] %> shown)</span>
</div>

<div class="grid" style="grid-template-columns: 1fr 2fr; gap: 1rem;">
  <ul id="tx_index_list" class="tx-list">
    <%= render partial: "transactions/summary_row",
               collection: @rows, as: :t %>
  </ul>
</div>
